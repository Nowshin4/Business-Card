<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1">
<title>Customize — Transparent Card Editor</title>
<style>
:root{--bg:#07120f;--green:#14B37D;--lemon:#F7FF66;color:rgba(255,255,255,0.9);font-family:Inter,Arial}
body{margin:0; min-height:100vh;background:linear-gradient(180deg,#03120f,#07120f); color:var(--muted)}
.header{display:flex;align-items:center;justify-content:space-between;padding:18px 22px;border-bottom:1px solid rgba(255,255,255,0.03)}
.container{max-width:1200px;margin:18px auto;padding:0 6vw; display:grid; grid-template-columns: 1fr 360px; gap:20px}
.canvas-wrap{background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01)); padding:18px;border-radius:12px;border:1px solid rgba(255,255,255,0.03)}
.controls{background:linear-gradient(180deg, rgba(255,255,255,0.01), transparent); padding:14px;border-radius:12px;border:1px solid rgba(255,255,255,0.03)}
#editor{width:100%; height:520px; background:linear-gradient(180deg, rgba(255,255,255,0.01), rgba(255,255,255,0.005)); border-radius:12px; display:flex;align-items:center;justify-content:center; position:relative; overflow:hidden}
canvas{background:transparent; max-width:100%; height:auto}
.input,select{width:100%;padding:10px;border-radius:10px;background:transparent;border:1px solid rgba(255,255,255,0.04);color:var(--muted);margin-bottom:10px}
.btn{padding:12px;border-radius:10px;border:0;background:linear-gradient(90deg,var(--green),#1ecf93);color:#032118;font-weight:800;cursor:pointer;width:100%}
.small{padding:8px 10px;border-radius:8px}
.footer{margin-top:20px;padding:16px;border-top:1px solid rgba(255,255,255,0.03)}
.note{font-size:13px;color:rgba(255,255,255,0.6)}
@media (max-width:960px){ .container{grid-template-columns:1fr} #editor{height:420px} }
</style>
</head>
<body>
<header class="header">
  <div style="display:flex;align-items:center;gap:12px"><div style="width:44px;height:44px;border-radius:12px;background:linear-gradient(90deg,var(--green),var(--lemon));display:flex;align-items:center;justify-content:center;font-weight:800">TC</div><div><strong>Transparent Card</strong><div style="font-size:12px;color:rgba(255,255,255,0.6)">Customizer</div></div></div>
  <nav><a href="shop.html">Shop</a> &nbsp; <a href="cart.html" style="color:var(--lemon)">Cart (<span id="cartCount">0</span>)</a></nav>
</header>

<main class="container">
  <section class="canvas-wrap">
    <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:10px">
      <div><strong>Live Canvas Editor</strong><div class="note">Add text, upload a logo or image, then add to cart.</div></div>
      <div style="display:flex;gap:8px">
        <button class="btn small" id="undo">Undo</button>
        <button class="btn small" id="export">Export PNG</button>
      </div>
    </div>
    <div id="editor">
      <canvas id="canvas" width="840" height="520" style="border-radius:12px; box-shadow: 0 30px 60px rgba(0,0,0,0.6)"></canvas>
    </div>
    <div style="margin-top:10px; display:flex;gap:10px;">
      <label class="input" style="flex:1">
        <input id="textInput" placeholder="Add your name or title" style="width:100%;background:transparent;border:0;color:var(--muted);outline:none">
      </label>
      <select id="fontSize" class="input" style="width:120px">
        <option value="28">28px</option><option value="36">36px</option><option value="48" selected>48px</option><option value="64">64px</option>
      </select>
      <button class="btn small" id="addTextBtn" style="width:120px">Add Text</button>
    </div>
  </section>

  <aside class="controls">
    <label>Preferred product
      <select id="pref">
        <option value="T1">Transparent</option><option value="T2">Transparent + Gold Foil</option><option value="T3">Transparent + Silver Foil</option><option value="T4">Transparent + Gold & Silver Foil</option>
      </select>
    </label>

    <label>Format
      <select id="format"><option>American</option><option>European</option><option>Square</option><option>Small</option></select>
    </label>

    <label>Orientation
      <select id="orientation"><option>Landscape</option><option>Portrait</option></select>
    </label>

    <label>Quantity
      <select id="qty"><option>50</option><option>500</option><option>1000</option></select>
    </label>

    <label>Upload image (logo)
      <input id="file" type="file" accept="image/*" class="input">
    </label>

    <div style="margin-top:8px" class="note">Click and drag uploaded image to reposition. Select text and drag to move. Use Undo to remove last item.</div>

    <div style="margin-top:12px">
      <div style="font-weight:800">Live price</div>
      <div style="font-size:18px;margin:8px 0" id="livePrice">$0</div>
      <button class="btn" id="addToCart">Add Customized to Cart</button>
    </div>

  </aside>
</main>

<footer class="footer">
  <div>© <span id="year"></span> Transparent Card</div>
  <div><a href="templates.html">Browse templates</a> • <a href="upload.html">Upload designs</a></div>
</footer>

<script>
/* Shared product price algorithm */
function priceFor(id, opts){
  const baseMap={T1:55, T2:72, T3:70, T4:95};
  let base = baseMap[id]||60;
  const formatMult = (opts.format==='European')?1.06:(opts.format==='Square')?1.1:(opts.format==='Small')?0.9:1;
  const finish = (id==='T1')?'Transparent': (id==='T2')?'Gold': (id==='T3')?'Silver':'Dual';
  const finishMult = (finish==='Dual')?1.45: (finish==='Gold'||finish==='Silver')?1.25:1;
  const qty = Number(opts.qty);
  let qtyMult = (qty===50)?1: (qty===500)?7.8:14.5;
  return Math.round(base * formatMult * finishMult * qtyMult);
}

/* Canvas editor minimal but functional */
const canvas = document.getElementById('canvas');
const ctx = canvas.getContext('2d');
const items = []; // {type:'text'|'image', x,y, text, font, size, img}
let dragging=null;
let dragOffset={x:0,y:0};

function drawBackground(){
  // subtle glass card background
  ctx.clearRect(0,0,canvas.width,canvas.height);
  const g = ctx.createLinearGradient(0,0,canvas.width,canvas.height);
  g.addColorStop(0,'rgba(10,20,18,0.2)');
  g.addColorStop(1,'rgba(5,10,8,0.1)');
  ctx.fillStyle = g;
  ctx.fillRect(0,0,canvas.width,canvas.height);

  // inner transparent card layer
  ctx.save();
  ctx.fillStyle = 'rgba(255,255,255,0.02)';
  roundRect(ctx,30,30,canvas.width-60,canvas.height-60,18);
  ctx.fill();
  ctx.restore();
}

function roundRect(ctx,x,y,w,h,r){ ctx.beginPath(); ctx.moveTo(x+r,y); ctx.lineTo(x+w-r,y); ctx.quadraticCurveTo(x+w,y,x+w,y+r); ctx.lineTo(x+w,y+h-r); ctx.quadraticCurveTo(x+w,y+h,x+w-r,y+h); ctx.lineTo(x+r,y+h); ctx.quadraticCurveTo(x,y+h,x,y+h-r); ctx.lineTo(x,y+r); ctx.quadraticCurveTo(x,y,x+r,y); ctx.closePath();}

function render(){
  drawBackground();
  items.forEach(it=>{
    if(it.type==='image' && it.img){
      ctx.save();
      ctx.globalAlpha = 0.95;
      ctx.drawImage(it.img, it.x, it.y, it.w, it.h);
      ctx.restore();
    } else if(it.type==='text'){
      ctx.save();
      ctx.font = `${it.size}px serif`;
      ctx.fillStyle = 'white';
      ctx.fillText(it.text, it.x, it.y);
      ctx.restore();
    }
  });
}

canvas.addEventListener('mousedown', e=>{
  const rect = canvas.getBoundingClientRect(); const x = (e.clientX-rect.left)*(canvas.width/rect.width); const y=(e.clientY-rect.top)*(canvas.height/rect.height);
  for(let i=items.length-1;i>=0;i--){
    const it=items[i];
    if(it.type==='text'){
      const w = ctx.measureText(it.text).width;
      const h = it.size;
      if(x>=it.x && x<=it.x+w && y<=it.y && y>=it.y-h){
        dragging = it; dragOffset.x = x - it.x; dragOffset.y = y - it.y; return;
      }
    } else if(it.type==='image'){
      if(x>=it.x && x<=it.x+it.w && y>=it.y && y<=it.y+it.h){ dragging=it; dragOffset.x = x-it.x; dragOffset.y=y-it.y; return;}
    }
  }
});
canvas.addEventListener('mousemove', e=>{
  if(!dragging) return;
  const rect = canvas.getBoundingClientRect(); const x = (e.clientX-rect.left)*(canvas.width/rect.width); const y=(e.clientY-rect.top)*(canvas.height/rect.height);
  dragging.x = x - dragOffset.x; dragging.y = y - dragOffset.y; render();
});
canvas.addEventListener('mouseup', ()=>{ dragging=null });
canvas.addEventListener('mouseleave', ()=>{ dragging=null });

document.getElementById('addTextBtn').addEventListener('click', ()=>{
  const txt = document.getElementById('textInput').value.trim() || 'Your Name';
  const size = Number(document.getElementById('fontSize').value) || 48;
  const it = {type:'text', text:txt, size, x:80, y:120};
  items.push(it); render();
});

document.getElementById('file').addEventListener('change', (ev)=>{
  const f = ev.target.files[0]; if(!f) return;
  const img = new Image();
  img.onload = function(){
    const ratio = Math.min(260/img.width, 160/img.height);
    const w = img.width * ratio, h = img.height * ratio;
    items.push({type:'image', img:this, x:120, y:160, w, h});
    render();
  }
  img.src = URL.createObjectURL(f);
});

document.getElementById('undo').addEventListener('click', ()=>{ items.pop(); render(); });

document.getElementById('export').addEventListener('click', ()=>{
  const url = canvas.toDataURL('image/png');
  const a = document.createElement('a'); a.href = url; a.download = 'card-preview.png'; a.click();
});

/* live price calculation */
function updatePrice(){
  const pref = document.getElementById('pref').value;
  const opts = {format:document.getElementById('format').value, orientation:document.getElementById('orientation').value, qty:Number(document.getElementById('qty').value)};
  const p = priceFor(pref, opts);
  document.getElementById('livePrice').textContent = '$'+p.toLocaleString();
}
['pref','format','orientation','qty'].forEach(id=>document.getElementById(id).addEventListener('change', updatePrice));
function priceFor(id, opts){
  const baseMap={T1:55, T2:72, T3:70, T4:95};
  let base = baseMap[id]||60;
  const formatMult = (opts.format==='European')?1.06:(opts.format==='Square')?1.1:(opts.format==='Small')?0.9:1;
  const finishMult = (id==='T4')?1.45: (id==='T2'||id==='T3')?1.25:1;
  const qty = Number(opts.qty);
  const qtyMult = (qty===50)?1:(qty===500)?7.8:14.5;
  return Math.round(base * formatMult * finishMult * qtyMult);
}
updatePrice();

/* Cart saving - saves image data & options */
function getCart(){ try{return JSON.parse(localStorage.getItem('tc_cart')||'[]')}catch(e){return[]}}
function setCart(c){localStorage.setItem('tc_cart', JSON.stringify(c)); updateCartCount();}
function updateCartCount(){ document.getElementById('cartCount').textContent = getCart().reduce((s,i)=>s+i.qty,0) }
document.getElementById('addToCart').addEventListener('click', ()=>{
  const pref = document.getElementById('pref').value; const opts = {format:document.getElementById('format').value, orientation:document.getElementById('orientation').value, qty:Number(document.getElementById('qty').value)};
  const price = priceFor(pref, opts);
  const dataURL = canvas.toDataURL('image/png');
  const key = 'custom|' + Date.now();
  const cart = getCart();
  cart.push({key, id:'CUSTOM', opts, qty:1, price, preview:dataURL});
  setCart(cart);
  alert('Customized design added to cart');
});

/* init pref from query param */
(function initFromQuery(){ const p = new URLSearchParams(location.search); const pref = p.get('pref'); if(pref){ document.getElementById('pref').value=pref; updatePrice(); } updateCartCount(); document.getElementById('year').textContent = new Date().getFullYear(); })();

render(); // initial
</script>
</body>
</html>
